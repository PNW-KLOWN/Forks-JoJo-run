<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Forks Ave ‚Äì JoJos Run</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

<style>
html,body{margin:0;padding:0;background:#87c9ff;font-family:system-ui,sans-serif}
canvas{display:block;margin:auto;background:linear-gradient(#87c9ff 0%,#bfe7ff 45%,#444 46%,#444 55%,#2f7d32 56%)}
#hud{
  position:fixed;top:0;left:0;width:100%;
  background:rgba(0,0,0,.75);color:white;
  padding:6px;font-size:14px;
  display:flex;justify-content:space-between;align-items:center
}
#controls{
  position:fixed;bottom:10px;left:0;width:100%;
  display:flex;justify-content:space-around
}
button{
  font-size:14px;padding:10px 12px;border-radius:10px;
  border:none;background:#222;color:white
}
button:active{background:#555}

.overlay{
  position:fixed;inset:0;background:rgba(0,0,0,.8);
  display:flex;align-items:center;justify-content:center;color:white
}
.panel{
  background:#142033;padding:20px;border-radius:16px;
  width:min(90vw,600px);text-align:center
}
.blink{animation:blink 1s infinite}
@keyframes blink{50%{opacity:.2}}
.answerBtn{
  display:block;width:100%;margin:6px 0;
  padding:8px;border-radius:10px;
  background:#2d6cdf
}
.answerBtn:active{background:#1f56b7}
</style>
</head>

<body>

<div id="hud">
  <div>
    üç∫ <span id="beer">6</span> |
    üíµ $<span id="cash">0</span> |
    ‚è± <span id="time">120</span>s
  </div>
  <div>
    <button id="reset">Reset</button>
  </div>
</div>

<canvas id="game" width="900" height="500"></canvas>

<div id="controls">
  <button id="left">‚¨Ö</button>
  <button id="jump">‚¨Ü</button>
  <button id="right">‚û°</button>
  <button id="talk">üí¨</button>
  <button id="grab">üßç</button>
  <button id="drink">üç∫</button>
</div>

<!-- TITLE SCREEN -->
<div class="overlay" id="title">
  <div class="panel">
    <h1>Forks Ave ‚Äì JoJos Run</h1>
    <p>Tom the Logger vs Everyone</p>
    <p class="blink">PRESS START</p>
    <button onclick="startGame()">Start</button>
  </div>
</div>

<!-- DIALOG SCREEN -->
<div class="overlay" id="dialog" style="display:none">
  <div class="panel">
    <p id="question"></p>
    <div id="answers"></div>
  </div>
</div>

<script>
/* ===== BASIC ===== */
const c=document.getElementById("game");
const ctx=c.getContext("2d");

let audioCtx=null;
function sound(f,d=.12){
  if(!audioCtx)return;
  const o=audioCtx.createOscillator(),g=audioCtx.createGain();
  o.type="square";o.frequency.value=f;g.gain.value=.06;
  o.connect(g);g.connect(audioCtx.destination);
  o.start();o.stop(audioCtx.currentTime+d);
}

/* ===== MUSIC ===== */
let musicTimer=null, musicStep=0;
const notes=[262,330,392,523,392,330];
function music(){
  sound(notes[musicStep++%notes.length],.1);
}
function startMusic(){
  musicTimer=setInterval(music,220);
}

/* ===== GAME STATE ===== */
let running=false, gameOver=false;
let timeLeft=120, cash=0;

const tom={x:40,y:360,w:30,h:40,vx:0,vy:0,big:true,beer:6};
let carrying=null;

/* ===== TOURISTS ===== */
const places=["Thriftway","Shell","76","Chinook Pharmacy","True Value"];

function makeTourist(x){
  return{
    x,y:370,w:26,h:36,
    known:false,
    type:Math.random()<.5?"smart":"annoying",
    throwable:false,
    vanish:false
  };
}

const tourists=[
  makeTourist(300),
  makeTourist(520),
  makeTourist(760)
];

/* ===== INPUT ===== */
const keys={};
document.onkeydown=e=>keys[e.key]=true;
document.onkeyup=e=>keys[e.key]=false;

left.onclick=()=>keys["ArrowLeft"]=true;
right.onclick=()=>keys["ArrowRight"]=true;
jump.onclick=()=>keys[" "]=true;
drink.onclick=drinkBeer;
talk.onclick=talk;
grab.onclick=grabThrow;
reset.onclick=()=>location.reload();

/* ===== START ===== */
function startGame(){
  document.getElementById("title").style.display="none";
  audioCtx=new AudioContext();
  startMusic();
  running=true;
}

/* ===== CORE ===== */
function drinkBeer(){
  if(tom.beer>0){
    tom.beer--;
    tom.big=true;
    sound(300);
  }
}

function nearestTourist(){
  return tourists.find(t=>!t.vanish && Math.abs(t.x-tom.x)<50);
}

function talk(){
  const t=nearestTourist();
  if(!t)return;

  if(!t.known){
    t.known=true;
    if(t.type==="annoying"){
      t.throwable=true;
      alert("Annoying tourist:\n\"Where can we find Edward?\"");
    }else{
      askDirections(t);
    }
  }else if(t.type==="smart"){
    askDirections(t);
  }else{
    alert("Annoying tourist:\n\"When do the deer turn into elk?\"");
  }
}

function askDirections(t){
  const correct=places[Math.floor(Math.random()*places.length)];
  let options=[...places];
  options.sort(()=>Math.random()-.5);

  document.getElementById("dialog").style.display="flex";
  document.getElementById("question").textContent=
    "Can you tell me how to get to "+correct+"?";

  const a=document.getElementById("answers");
  a.innerHTML="";
  options.forEach(opt=>{
    const b=document.createElement("button");
    b.className="answerBtn";
    b.textContent=opt;
    b.onclick=()=>{
      document.getElementById("dialog").style.display="none";
      if(opt===correct){
        const tip=5+Math.floor(Math.random()*6);
        cash+=tip;
        sound(800);
        alert("Correct! Tip: $"+tip);
      }else{
        alert("That doesn't sound right...");
      }
    };
    a.appendChild(b);
  });
}

function grabThrow(){
  if(carrying){
    carrying.vanish=true;
    carrying=null;
    sound(120);
    return;
  }
  const t=nearestTourist();
  if(!t||!t.throwable){
    alert("Can't throw this tourist.");
    return;
  }
  carrying=t;
}

/* ===== UPDATE / DRAW ===== */
function update(dt){
  if(!running)return;

  if(keys["ArrowLeft"])tom.vx=-200;
  else if(keys["ArrowRight"])tom.vx=200;
  else tom.vx=0;

  if(keys[" "]&&tom.y>=360){
    tom.vy=-600;
    sound(600);
  }

  tom.vy+=1600*dt;
  tom.x+=tom.vx*dt;
  tom.y+=tom.vy*dt;

  if(tom.y>360){tom.y=360;tom.vy=0;}

  timeLeft-=dt;
  if(timeLeft<=0){
    alert("Tourists bought the JoJos.");
    location.reload();
  }
}

function draw(){
  ctx.clearRect(0,0,900,500);

  // ground
  ctx.fillStyle="#2f7d32";
  ctx.fillRect(0,400,2000,100);

  // road
  ctx.fillStyle="#444";
  ctx.fillRect(0,360,2000,40);

  // Tom
  ctx.fillStyle=tom.big?"#2d6cdf":"#8fb3ff";
  ctx.fillRect(tom.x,tom.y,tom.w,tom.h);
  ctx.fillStyle="#ffd966";
  ctx.fillRect(tom.x+6,tom.y,18,10);

  // Tourists
  tourists.forEach(t=>{
    if(t.vanish)return;
    ctx.fillStyle=!t.known?"#aaa":t.type==="smart"?"#2ecc71":"#ffb74d";
    ctx.fillRect(t.x,t.y,t.w,t.h);
  });

  document.getElementById("beer").textContent=tom.beer;
  document.getElementById("cash").textContent=cash;
  document.getElementById("time").textContent=Math.floor(timeLeft);
}

/* ===== LOOP ===== */
let last=0;
function loop(ts){
  const dt=(ts-last)/1000;last=ts;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>

</body>
</html>
