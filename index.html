<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Forks Ave ‚Äî JoJos Run</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />

<style>
*{
  -webkit-touch-callout:none;
  -webkit-user-select:none;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
}
html,body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  background:#071021;
  overflow:hidden;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
}

#wrap{
  width:100vw;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

canvas{
  width:100vw;
  max-width:520px;
  height:100vh;
  max-height:960px;
  background:#8fd3ff;
  image-rendering:pixelated;
  border-radius:14px;
  touch-action:none;
}

#hud{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  padding:8px 10px;
  background:rgba(0,0,0,.75);
  color:#fff;
  display:flex;
  justify-content:space-between;
  z-index:10;
  font-size:14px;
}

#controls{
  position:fixed;
  bottom:10px;
  left:0;
  right:0;
  display:flex;
  gap:8px;
  padding:0 10px;
  z-index:10;
}

.ctrl{
  flex:1;
  padding:14px 10px;
  font-size:16px;
  font-weight:800;
  border:none;
  border-radius:16px;
  background:#111827;
  color:white;
}

.ctrl.jump{ background:#16a34a; }
.ctrl.action{ background:#2563eb; }

.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:20;
}

.panel{
  width:92%;
  max-width:520px;
  background:#0f1e35;
  color:white;
  padding:18px;
  border-radius:18px;
}

.panel h1{ margin:0 0 10px; }
.panel p{ line-height:1.35; }

.panel button{
  width:100%;
  margin-top:10px;
  padding:14px;
  font-size:18px;
  font-weight:900;
  border:none;
  border-radius:16px;
  background:#2563eb;
  color:white;
}
.panel button.secondary{
  background:#1f2937;
}
</style>
</head>

<body>

<div id="hud">
  <div>üç∫ <span id="hudBeer">6</span> | üíµ $<span id="hudCash">0</span> | ‚è± <span id="hudTime">160</span></div>
  <button onclick="location.reload()">Reset</button>
</div>

<div id="wrap">
  <canvas id="game" width="360" height="640"></canvas>
</div>

<div id="controls">
  <button class="ctrl" id="left">‚¨Ö</button>
  <button class="ctrl jump" id="jump">JUMP</button>
  <button class="ctrl" id="right">‚û°</button>
  <button class="ctrl action" id="action">ACTION</button>
</div>

<div class="overlay" id="startScreen">
  <div class="panel">
    <h1>Forks Ave ‚Äî JoJos Run</h1>
    <p>The crew bus just dropped Tom off at the 76. He‚Äôs on a mission to reach Thriftway‚Äôs hot case before the tourists wipe out the chicken strips and JoJos.</p>
    <p>Talk to tourists first. Smart ones tip if you give directions. Annoying ones can be thrown.</p>
    <p>Defeat vampires, werewolves, and Sassy the Sasquatch to win.</p>
    <button id="startBtn">START</button>
    <button class="secondary" id="howBtn">CONTROLS / GOAL</button>
  </div>
</div>

<div class="overlay" id="howScreen" style="display:none;">
  <div class="panel">
    <h1>How to Play</h1>
    <p><b>Mobile:</b> Use on-screen buttons.</p>
    <p><b>Keyboard:</b> Arrow keys or A/D to move, W/Up to jump, Space/Enter = Action.</p>
    <p><b>Action button:</b> Talk, grab, throw, drink beer.</p>
    <p><b>Goal:</b> Defeat Sasquatch, enter Thriftway, win.</p>
    <button id="backBtn">BACK</button>
  </div>
</div>

<script>
/* ===== SECTION 1 JS: Core + Audio (NO GAMEPLAY YET) ===== */

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let running = false;

/* ---- AUDIO (THIS IS THE FIXED PART) ---- */
let audioCtx = null;
let musicTimer = null;
let noteIndex = 0;

const melody = [
  262,294,330,392,440,392,330,294,
  262,330,392,523,587,523,392,330
];

function startMusic(){
  if(!audioCtx){
    audioCtx = new (window.AudioContext||window.webkitAudioContext)();
  }
  if(audioCtx.state === "suspended"){
    audioCtx.resume();
  }
  if(musicTimer) return;

  musicTimer = setInterval(()=>{
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type="square";
    osc.frequency.value = melody[noteIndex++ % melody.length];
    gain.gain.value = 0.05;
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 0.12);
  }, 180);
}

/* ---- INPUT (touch + keyboard) ---- */
const input = { left:false, right:false };

function bindHold(id, prop){
  const el=document.getElementById(id);
  el.addEventListener("pointerdown", e=>{ e.preventDefault(); input[prop]=true; startMusic(); });
  el.addEventListener("pointerup",   e=>{ e.preventDefault(); input[prop]=false; });
  el.addEventListener("pointerleave",e=>{ e.preventDefault(); input[prop]=false; });
}

bindHold("left","left");
bindHold("right","right");

document.getElementById("jump").onclick = ()=>startMusic();
document.getElementById("action").onclick = ()=>startMusic();

window.addEventListener("keydown", e=>{
  startMusic();
  if(e.key==="ArrowLeft"||e.key==="a") input.left=true;
  if(e.key==="ArrowRight"||e.key==="d") input.right=true;
});
window.addEventListener("keyup", e=>{
  if(e.key==="ArrowLeft"||e.key==="a") input.left=false;
  if(e.key==="ArrowRight"||e.key==="d") input.right=false;
});

/* ---- SCREENS ---- */
document.getElementById("startBtn").onclick = ()=>{
  document.getElementById("startScreen").style.display="none";
  running=true;
  startMusic();
};
document.getElementById("howBtn").onclick = ()=>{
  document.getElementById("howScreen").style.display="flex";
};
document.getElementById("backBtn").onclick = ()=>{
  document.getElementById("howScreen").style.display="none";
};

/* ---- BASIC DRAW LOOP (placeholder) ---- */
function loop(){
  ctx.fillStyle="#8fd3ff";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle="#1f7a3a";
  ctx.fillRect(0,400,canvas.width,240);

  ctx.fillStyle="#000";
  ctx.font="16px system-ui";
  ctx.textAlign="center";
  ctx.fillText(running ? "GAME RUNNING" : "TITLE SCREEN", canvas.width/2, 320);

  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
